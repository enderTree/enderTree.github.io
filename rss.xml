<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ENDER</title><link>https://enderTree.github.io/</link><description>Share something interesting about byte ocean</description><atom:link href="https://enderTree.github.io/rss.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2019 &lt;a href="mailto:ender@sina.cn"&gt;ender&lt;/a&gt; </copyright><lastBuildDate>Mon, 18 Nov 2019 02:38:35 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>阿里云maxcompute数据同步问题</title><link>https://enderTree.github.io/posts/maxcompute_datax_20191115/</link><dc:creator>ender</dc:creator><description>&lt;div&gt;&lt;h2 id="maxcompute"&gt;阿里云maxcompute数据同步问题&lt;/h2&gt;
&lt;h3 id="_1"&gt;&lt;/h3&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;上周五快要下班时，客服反馈了个问题，表示前端展示有问题，经过一番排查，定位到问题是阿里云数据同步组件报错：错误如下：
    &lt;span class="mi"&gt;2019&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt; &lt;span class="mi"&gt;18&lt;/span&gt;:&lt;span class="mi"&gt;29&lt;/span&gt;:&lt;span class="mi"&gt;01&lt;/span&gt;.&lt;span class="mi"&gt;882&lt;/span&gt; [&lt;span class="mi"&gt;176031158&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;writer&lt;/span&gt;] &lt;span class="nv"&gt;WARN&lt;/span&gt;  &lt;span class="nv"&gt;CommonRdbmsWriter&lt;/span&gt;$&lt;span class="nv"&gt;Task&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; 回滚此次写入, 采用每次写入一行方式提交. 因为:&lt;span class="nv"&gt;java&lt;/span&gt;.&lt;span class="nv"&gt;sql&lt;/span&gt;.&lt;span class="nv"&gt;BatchUpdateException&lt;/span&gt;: &lt;span class="nv"&gt;Duplicate&lt;/span&gt; &lt;span class="nv"&gt;entry&lt;/span&gt; &lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="s"&gt;*******&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="s"&gt;uk_&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="o"&gt;*******&lt;/span&gt;&lt;span class="s1"&gt;''&lt;/span&gt;
    &lt;span class="nv"&gt;Caused&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt;: &lt;span class="nv"&gt;com&lt;/span&gt;.&lt;span class="nv"&gt;mysql&lt;/span&gt;.&lt;span class="nv"&gt;jdbc&lt;/span&gt;.&lt;span class="nv"&gt;exceptions&lt;/span&gt;.&lt;span class="nv"&gt;jdbc4&lt;/span&gt;.&lt;span class="nv"&gt;MySQLIntegrityConstraintViolationException&lt;/span&gt;: &lt;span class="nv"&gt;Duplicate&lt;/span&gt; &lt;span class="nv"&gt;entry&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="o"&gt;*******&lt;/span&gt;&lt;span class="s1"&gt;''&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="s"&gt;uk_&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="o"&gt;*******&lt;/span&gt;&lt;span class="s1"&gt;''&lt;/span&gt;

但是数据同步组件我们设置的是：主键冲突时：&lt;span class="nv"&gt;on&lt;/span&gt; &lt;span class="nv"&gt;duplicate&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;当主键&lt;span class="o"&gt;/&lt;/span&gt;约束冲突&lt;span class="nv"&gt;update&lt;/span&gt;数据&lt;span class="ss"&gt;)&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;​   &lt;img alt="https://endertree.github.io/galleries/TIM_20191118100942.thumbnail.png" src="https://enderTree.github.io/posts/maxcompute_datax_20191115/"&gt;
​   并且看日志中的sql也是对的：&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ss"&gt;```sql&lt;/span&gt;
&lt;span class="ss"&gt;INSERT INTO %s (is_delete,product_version,total_period,current_period,ackamt,realrepay_dt,subamt,repay_dt,category,`&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="ss"&gt;`,productname,productid,main_productid,custno,apdt) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) ON DUPLICATE KEY UPDATE is_delete=VALUES(is_delete),product_version=VALUES(product_version),total_period=VALUES(total_period),current_period=VALUES(current_period),ackamt=VALUES(ackamt),realrepay_dt=VALUES(realrepay_dt),subamt=VALUES(subamt),repay_dt=VALUES(repay_dt),category=VALUES(category),`&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="ss"&gt;`=VALUES(`&lt;/span&gt;&lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="ss"&gt;`),productname=VALUES(productname),productid=VALUES(productid),main_productid=VALUES(main_productid),custno=VALUES(custno),apdt=VALUES(apdt)&lt;/span&gt;
&lt;span class="ss"&gt;```&lt;/span&gt;
&lt;span class="err"&gt;按照这种语法是不会出现主键约束冲突的，但事实就摆在眼前，很奇怪的报错，我们仔细对比了数据同步任务的各个字段，也查询了表中的数据，最后我们把上面&lt;/span&gt;&lt;span class="n"&gt;sql拼接好&lt;/span&gt;&lt;span class="err"&gt;，放到数据库中运行，发现还是报错，错误是一样的。&lt;/span&gt;
&lt;span class="err"&gt;接下来，我们复制了一次目标表，里面放置一条报错的数据，再次使用&lt;/span&gt;&lt;span class="n"&gt;sql进行插入&lt;/span&gt;&lt;span class="err"&gt;，发现不报错了，这个时候我们突发奇想这张表的自增长主键会不会出问题了，一看发现已达&lt;/span&gt;&lt;span class="n"&gt;int&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="err"&gt;的最大值：&lt;/span&gt;&lt;span class="kp"&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2147483647&lt;/span&gt;
&lt;span class="err"&gt;不得已我们把字段类型变为&lt;/span&gt;&lt;span class="n"&gt;bigint&lt;/span&gt;&lt;span class="err"&gt;。&lt;/span&gt;
&lt;span class="err"&gt;以上。&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>markdown</category><guid>https://enderTree.github.io/posts/maxcompute_datax_20191115/</guid><pubDate>Mon, 18 Nov 2019 02:04:35 GMT</pubDate></item><item><title>hbase学习</title><link>https://enderTree.github.io/posts/hbase_learning/</link><dc:creator>ender</dc:creator><description>&lt;div&gt;&lt;h2 id="hbase"&gt;hbase学习&lt;/h2&gt;
&lt;h3 id="_1"&gt;简介&lt;/h3&gt;
&lt;h3 id="_2"&gt;安装&lt;/h3&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;安装&lt;/span&gt;&lt;span class="n"&gt;hadoop&lt;/span&gt;
&lt;span class="err"&gt;安装&lt;/span&gt;&lt;span class="n"&gt;zookeeper&lt;/span&gt;
&lt;span class="err"&gt;安装&lt;/span&gt;&lt;span class="n"&gt;hbase&lt;/span&gt;
&lt;/pre&gt;


&lt;h3 id="_3"&gt;实践&lt;/h3&gt;
&lt;p&gt;ps&lt;/p&gt;&lt;/div&gt;</description><category>markdown</category><guid>https://enderTree.github.io/posts/hbase_learning/</guid><pubDate>Wed, 14 Nov 2018 10:27:35 GMT</pubDate></item><item><title>我的第一篇文章</title><link>https://enderTree.github.io/posts/first_blood/</link><dc:creator>ender</dc:creator><description>&lt;div&gt;&lt;h3 id="_1"&gt;第一篇文章！&lt;/h3&gt;
&lt;p&gt;本博客借鉴于  https://macplay.github.io/posts/30-fen-zhong-jian-li-yi-ge-nikola-bo-ke/&lt;/p&gt;&lt;/div&gt;</description><category>markdown</category><category>nikola</category><guid>https://enderTree.github.io/posts/first_blood/</guid><pubDate>Wed, 14 Nov 2018 03:32:34 GMT</pubDate></item></channel></rss>